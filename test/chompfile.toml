version = 0.1

[template-options.npm]
  auto-install = true

[[task]]
  name = "test"
  serial = true
  deps = ["test:init", "fail", "prettier", "jspm", "svelte", "swc", "babel", "check"]

[[task]]
  name = "fail"
  run = """
    chomp test:fail
    echo "recover"
  """

# verify that a serial failure stops the build and logs correctly
[[task]]
  name = "test:fail"
  serial = true
  deps = ["test:init", "prettier", "jspm", "failtask", "test:never"]

# never task -> writes never.txt which is caught by check
[[task]]
  name = "test:never"
  run = "echo \"FAILURE\" > testlog.txt"

[[task]]
  name = "failtask"
  run = "none"

[[task]]
  name = "check"
  deps = ["app-build.html", "test.js"]
  run = """
    echo \"TESTS OK\" >> testlog.txt
    cat testlog.txt
    rm testlog.txt
  """

[[task]]
  name = "test:init"
  run = """
    rm -r node_modules
    rm package.json
    rm package-lock.json
    rm test.js
    rm test.js.map
    rm -r lib
    rm app-build.html
    rm test-babel.js
    rm test-babel.js.map
    echo "export var p:number=5;" > test.ts
  """

[[task]]
  name = "prettier"
  template = "prettier"

[[task]]
  name = "jspm"
  template = "jspm"
  target = "app-build.html"
  deps = ["app.html"]

[[task]]
  name = "svelte"
  template = "svelte"
  target = "lib/test.js"
  deps = ["src/test.svelte"]

[[task]]
  name = "swc"
  template = "swc"
  target = "test.js"
  deps = ["test.ts"]

[[task]]
  name = "babel"
  template = "babel"
  target = "test-babel.js"
  deps = ["test.ts"]
  [task.template-options]
    presets = ['@babel/preset-typescript']
